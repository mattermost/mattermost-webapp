"use strict";(self.webpackChunk_mattermost_webapp=self.webpackChunk_mattermost_webapp||[]).push([[665],{63470:(e,t,a)=>{a.d(t,{QI:()=>s,sk:()=>o,lg:()=>i});var r=a(33383),n=a(12707);function s(e){return(t,a)=>{const s=(0,n.rc)(a());return t(r.zP(s,!0,e))}}function o(){return(e,t)=>{const a=(0,n.rc)(t());return e(r.zP(a,!1))}}function i(){return(e,t)=>{const a=(0,n.rc)(t());return e(r.lg(a))}}},96512:(e,t,a)=>{a.d(t,{Z:()=>d});var r=a(45697),n=a.n(r),s=a(67294),o=a(86896),i=a(44012),c=a(73727),l=a(94184),u=a.n(l);const m=e=>{let{url:t,className:a,onClick:r}=e;const{formatMessage:n}=(0,o.Z)();return s.createElement("div",{id:"back_button",className:u()("signup-header",a)},s.createElement(c.Link,{onClick:r,to:t},s.createElement("span",{id:"back_button_icon",className:"fa fa-1x fa-angle-left",title:n({id:"generic_icons.back",defaultMessage:"Back Icon"})}),s.createElement(i.Z,{id:"web.header.back",defaultMessage:"Back"})))};m.propTypes={url:n().string,className:n().string,onClick:n().func},m.defaultProps={url:"/"};const d=m},17665:(e,t,a)=>{a.r(t),a.d(t,{default:()=>C});var r=a(14494),n=a(22742),s=a(45697),o=a.n(s),i=(a(74916),a(4723),a(19601),a(67294)),c=a(44012),l=a(5977),u=a(34288),m=a(16406),d=a(96512),p=a(73406),f=a(97779),h=a(12707),g=a(63470),b=(a(15306),a(31055)),E=a(82251),v=a(45288),y=a(927);function M(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class N extends i.PureComponent{constructor(e){super(e),M(this,"input",void 0),M(this,"submit",(e=>{var t,a;e.preventDefault();const r=null===(t=this.input)||void 0===t||null===(a=t.current)||void 0===a?void 0:a.value.replace(/\s/g,"");r&&0!==r.length?(this.setState({error:null}),this.props.actions.activateMfa(r).then((e=>{let{error:t}=e;t?"ent.mfa.activate.authenticate.app_error"===t.server_error_id?this.setState({error:b._u("mfa.setup.badCode","Invalid code. If this issue persists, contact your System Administrator.")}):this.setState({error:t.message}):this.props.history.push("/mfa/confirm")}))):this.setState({error:b._u("mfa.setup.codeError","Please enter the code from Google Authenticator.")})})),this.state={secret:"",qrCode:""},this.input=i.createRef()}componentDidMount(){const e=this.props.currentUser;e&&!e.mfa_active?this.props.actions.generateMfaSecret().then((e=>{let{data:t,error:a}=e;a?this.setState({serverError:a.message}):this.setState({secret:t.secret,qrCode:t.qr_code})})):this.props.history.push("/")}render(){let e,t,a="form-group";return this.state.error&&(e=i.createElement("div",{className:"form-group has-error"},i.createElement("label",{className:"control-label"},this.state.error)),a+=" has-error"),this.props.enforceMultifactorAuthentication&&(t=i.createElement("p",null,i.createElement(v.Z,{id:"mfa.setup.required",defaultMessage:"**Multi-factor authentication is required on {siteName}.**",values:{siteName:this.props.siteName}}))),i.createElement("div",null,i.createElement("form",{onSubmit:this.submit,className:a},t,i.createElement("p",null,i.createElement(v.Z,{id:"mfa.setup.step1",defaultMessage:"**Step 1: **On your phone, download Google Authenticator from [iTunes](!https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8') or [Google Play](!https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en)"})),i.createElement("p",null,i.createElement(v.Z,{id:"mfa.setup.step2",defaultMessage:"**Step 2: **Use Google Authenticator to scan this QR code, or manually type in the secret key"})),i.createElement("div",{className:"form-group"},i.createElement("div",{className:"col-sm-12"},i.createElement("img",{alt:"qr code image",style:A.qrCode,src:"data:image/png;base64,"+this.state.qrCode}))),i.createElement("br",null),i.createElement("div",{className:"form-group"},i.createElement("p",{className:"col-sm-12"},i.createElement(c.Z,{id:"mfa.setup.secret",defaultMessage:"Secret: {secret}",values:{secret:this.state.secret}}))),i.createElement("p",null,i.createElement(v.Z,{id:"mfa.setup.step3",defaultMessage:"**Step 3: **Enter the code generated by Google Authenticator"})),i.createElement("p",null,i.createElement(y.Z,{ref:this.input,className:"form-control",placeholder:{id:(0,E.t)("mfa.setup.code"),defaultMessage:"MFA Code"},autoFocus:!0})),e,i.createElement("button",{type:"submit",className:"btn btn-primary"},i.createElement(c.Z,{id:"mfa.setup.save",defaultMessage:"Save"}))))}}M(N,"propTypes",{state:o().shape({enforceMultifactorAuthentication:o().bool.isRequired}).isRequired,updateParent:o().func.isRequired,siteName:o().string,enforceMultifactorAuthentication:o().bool.isRequired,actions:o().shape({activateMfa:o().func.isRequired,generateMfaSecret:o().func.isRequired}).isRequired,history:o().shape({}).isRequired});const A={qrCode:{maxHeight:170}},k=(0,r.connect)((function(e){const t=(0,n.iE)(e),a=t.SiteName,r="true"===t.EnforceMultifactorAuthentication;return{currentUser:(0,h.ts)(e),siteName:a,enforceMultifactorAuthentication:r}}),(function(e){return{actions:(0,f.bindActionCreators)({activateMfa:g.QI,generateMfaSecret:g.lg},e)}}))(N);function q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a(33948);const P=a(66788).ZP.KeyCodes;class Z extends i.PureComponent{constructor(){super(...arguments),q(this,"submit",(e=>{e.preventDefault(),(0,u.mc)()})),q(this,"onKeyPress",(e=>{(0,b.pD)(e,P.ENTER)&&this.submit(e)}))}componentDidMount(){document.body.addEventListener("keydown",this.onKeyPress)}componentWillUnmount(){document.body.removeEventListener("keydown",this.onKeyPress)}render(){return i.createElement("div",null,i.createElement("form",{onSubmit:this.submit,onKeyPress:this.onKeyPress,className:"form-group"},i.createElement("p",null,i.createElement(v.Z,{id:"mfa.confirm.complete",defaultMessage:"**Set up complete!**"})),i.createElement("p",null,i.createElement(c.Z,{id:"mfa.confirm.secure",defaultMessage:"Your account is now secure. Next time you sign in, you will be asked to enter a code from the Google Authenticator app on your phone."})),i.createElement("button",{type:"submit",className:"btn btn-primary"},i.createElement(c.Z,{id:"mfa.confirm.okay",defaultMessage:"Okay"}))))}}function R(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}q(Z,"propTypes",{state:o().shape({enforceMultifactorAuthentication:o().bool.isRequired}).isRequired,updateParent:o().func.isRequired});class S extends i.PureComponent{constructor(e){super(e),R(this,"handleOnClick",(e=>{e.preventDefault(),(0,u.gc)("/login")})),R(this,"updateParent",(e=>{this.setState(e)})),this.state={enforceMultifactorAuthentication:e.enableMultifactorAuthentication}}componentDidMount(){document.body.classList.add("sticky"),document.getElementById("root").classList.add("container-fluid"),this.props.enableMultifactorAuthentication||this.props.history.push("/")}componentWillUnmount(){document.body.classList.remove("sticky"),document.getElementById("root").classList.remove("container-fluid")}render(){let e;return e=this.props.mfa&&this.props.enforceMultifactorAuthentication?i.createElement("div",{className:"signup-header"},i.createElement("button",{className:"style--none color--link",onClick:this.handleOnClick},i.createElement(p.Z,null),i.createElement(c.Z,{id:"web.header.logout",defaultMessage:"Logout"}))):i.createElement(d.Z,null),i.createElement("div",{className:"inner-wrap"},i.createElement("div",{className:"row content"},i.createElement("div",null,e,i.createElement("div",{className:"col-sm-12"},i.createElement("div",{className:"signup-team__container"},i.createElement("h3",null,i.createElement(c.Z,{id:"mfa.setupTitle",defaultMessage:"Multi-factor Authentication Setup"})),i.createElement("img",{alt:"signup team logo",className:"signup-team-logo",src:m.Z}),i.createElement("div",{id:"mfa"},i.createElement(l.rs,null,i.createElement(l.AW,{path:"".concat(this.props.match.url,"/setup"),render:e=>i.createElement(k,Object.assign({state:this.state,updateParent:this.updateParent},e))}),i.createElement(l.AW,{path:"".concat(this.props.match.url,"/confirm"),render:e=>i.createElement(Z,Object.assign({state:this.state,updateParent:this.updateParent},e))}))))))))}}R(S,"propTypes",{location:o().shape({search:o().string.isRequired}).isRequired,children:o().node,mfa:o().bool.isRequired,enableMultifactorAuthentication:o().bool.isRequired,enforceMultifactorAuthentication:o().bool.isRequired,match:o().shape({url:o().string.isRequired}).isRequired});const C=(0,r.connect)((function(e){const t=(0,n.lJ)(e),a=(0,n.iE)(e);return{mfa:"true"===t.MFA,enableMultifactorAuthentication:"true"===a.EnableMultifactorAuthentication,enforceMultifactorAuthentication:"true"===a.EnforceMultifactorAuthentication}}))(S)},73406:(e,t,a)=>{a.d(t,{Z:()=>s});var r=a(67294),n=a(86896);function s(){const{formatMessage:e}=(0,n.Z)();return r.createElement("i",{className:"fa fa-1x fa-angle-left",title:e({id:"generic_icons.logout",defaultMessage:"Logout Icon"})})}},16406:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"files/ab8aa80cba445eb0fb75e6611c292567.png"}}]);
//# sourceMappingURL=665.fe519b8f357d98576f88.js.map